name: Daily Data Update (Staging)

on:
  schedule:
    - cron: '0 0 * * *'  # Run every day at UTC 00:00 (staging only)
  workflow_dispatch:      # Allow manual trigger

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: Execute update via SSH
        uses: appleboy/ssh-action@v1.2.5
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/hallyuhub
            # Use Ollama (free, local) instead of Gemini
            docker exec hallyuhub sh -c "npm run atualize:ai -- --provider=ollama"
            echo "âœ… Data update triggered successfully inside container with Ollama."
