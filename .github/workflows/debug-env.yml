name: üîç Debug Env

on:
  workflow_dispatch:
    inputs:
      command:
        description: 'Specific command to run (replaces default)'
        required: false
        default: ''

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Debug Env File
        uses: appleboy/ssh-action@v1.2.5
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /var/www/hallyuhub
            if [ -n "${{ github.event.inputs.command }}" ]; then
              echo "üöÄ Running custom command: ${{ github.event.inputs.command }}"
              ${{ github.event.inputs.command }}
            else
              echo "üìÇ Listing files:"
              ls -la
              echo "--------------------------------"
              echo "‚ùì Checking .env.production keys:"
              grep -o '^[^=]*' .env.production || echo "Grep failed or file empty"
              echo "--------------------------------"
              echo "‚ùì Checking DATABASE_URL value (masked):"
              grep "DATABASE_URL" .env.production | sed 's/DATABASE_URL=.*/DATABASE_URL=******/' || echo "DATABASE_URL not found"
            fi
